# Default values for wellq
# This is a YAML-formatted file.

# Global settings
global:
  imageRegistry: ""
  imagePullSecrets: []

# Application settings
app:
  name: wellq
  version: "1.0.0"

# Image configuration
image:
  registry: docker.io
  repository: wellq
  tag: "latest"
  pullPolicy: IfNotPresent

# Replica counts
replicaCount:
  web: 2
  celery: 2
  celeryBeat: 1

# Service configuration
service:
  type: ClusterIP
  port: 8000
  annotations: {}

# Ingress configuration
ingress:
  enabled: true
  className: "nginx"
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/proxy-body-size: "100m"
  hosts:
    - host: wellq.example.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: wellq-tls
      hosts:
        - wellq.example.com

# Resource limits and requests
resources:
  web:
    requests:
      memory: "512Mi"
      cpu: "250m"
    limits:
      memory: "2Gi"
      cpu: "1000m"
  celery:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "1Gi"
      cpu: "500m"
  celeryBeat:
    requests:
      memory: "128Mi"
      cpu: "50m"
    limits:
      memory: "512Mi"
      cpu: "200m"

# Autoscaling
autoscaling:
  web:
    enabled: false
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 80
    targetMemoryUtilizationPercentage: 80
  celery:
    enabled: false
    minReplicas: 2
    maxReplicas: 5
    targetCPUUtilizationPercentage: 80

# Node selector, tolerations, and affinity
nodeSelector: {}
tolerations: []
affinity: {}

# Pod annotations
podAnnotations: {}

# Pod security context
podSecurityContext:
  fsGroup: 1000
  runAsNonRoot: true
  runAsUser: 1000

# Container security context
securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: false
  runAsNonRoot: true
  runAsUser: 1000

# Django settings
django:
  secretKey: ""  # Must be set via secrets or values
  debug: "False"
  environment: "production"
  allowedHosts: "wellq.example.com,localhost"
  timeZone: "UTC"
  languageCode: "en-us"

# Database configuration
database:
  # Use external database or Bitnami PostgreSQL chart
  external:
    enabled: false
    host: ""
    port: 5432
    name: "wellq"
    user: "wellq"
    password: ""  # Set via secret
    sslMode: "require"

# PostgreSQL (Bitnami chart) - used if database.external.enabled is false
postgresql:
  enabled: true
  auth:
    database: "wellq"
    username: "wellq"
    password: ""  # Auto-generated if not set
    postgresPassword: ""  # Auto-generated if not set
  persistence:
    enabled: true
    size: 20Gi
    storageClass: ""
  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"

# Redis configuration
redisExternal:
  # Use external Redis or Bitnami Redis chart
  enabled: false
  host: ""
  port: 6379
  password: ""  # Set via secret
  database: 0

# Redis (Bitnami chart) - used if redisExternal.enabled is false
redis:
  enabled: true
  auth:
    enabled: true
    password: ""  # Auto-generated if not set
  master:
    persistence:
      enabled: true
      size: 8Gi
      storageClass: ""
    resources:
      requests:
        memory: "128Mi"
        cpu: "100m"
      limits:
        memory: "256Mi"
        cpu: "200m"

# Celery configuration
celery:
  brokerUrl: ""  # Auto-configured if using Redis chart
  resultBackend: ""  # Auto-configured if using Redis chart
  taskTimeLimit: 1800  # 30 minutes
  taskSoftTimeLimit: 1500  # 25 minutes
  workerConcurrency: 2
  beatSchedule:
    enrichFindingsDaily:
      task: "core.tasks.enrich_findings_with_threat_intel"
      schedule: "0 2 * * *"  # Daily at 2 AM

# Static files and media
storage:
  staticFiles:
    enabled: true
    size: 5Gi
    storageClass: ""
  media:
    enabled: true
    size: 50Gi
    storageClass: ""

# Health checks
healthCheck:
  enabled: true
  livenessProbe:
    httpGet:
      path: /health/
      port: http
    initialDelaySeconds: 60
    periodSeconds: 30
    timeoutSeconds: 10
    failureThreshold: 3
  readinessProbe:
    httpGet:
      path: /health/
      port: http
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

# Secrets (should be managed via external secret management)
secrets:
  # These should be set via Kubernetes secrets or external secret operator
  # Example: kubectl create secret generic wellq-secrets --from-literal=secret-key=xxx
  secretKey: ""
  dbPassword: ""
  redisPassword: ""

# Service account
serviceAccount:
  create: true
  annotations: {}
  name: ""

# RBAC
rbac:
  create: true

# Pod disruption budget
podDisruptionBudget:
  enabled: true
  web:
    minAvailable: 1
  celery:
    minAvailable: 1

# Network policies
networkPolicy:
  enabled: false
  ingress: []
  egress: []

# Monitoring
monitoring:
  enabled: false
  serviceMonitor:
    enabled: false
    interval: 30s
    scrapeTimeout: 10s

# Logging
logging:
  level: "INFO"
  format: "json"

# Extra environment variables
extraEnv: []
# Example:
# extraEnv:
#   - name: EXTRA_VAR
#     value: "value"

# Extra volumes
extraVolumes: []
extraVolumeMounts: []

# Init containers
initContainers: []
# Example:
# initContainers:
#   - name: wait-for-db
#     image: busybox:1.35
#     command: ['sh', '-c', 'until nc -z postgresql 5432; do sleep 2; done']

